<ons-page ng-controller="HoleListController">
  <ons-sliding-menu var="menu" menu-page="left-menu.html" swipeable max-slide-distance="260px" type="push">

    <div class="main">
      <ons-page>
        <ons-pull-hook var="loader" ng-action="refresh($done)">
          <span ng-switch="loader.getCurrentState()">
            <span ng-switch-when="initial">
              <ons-icon size="30px" icon="ion-arrow-down-a"></ons-icon>
              下拉刷新列表
            </span>
            <span ng-switch-when="preaction">
              <ons-icon size="30px" icon="ion-arrow-up-a"></ons-icon>
              松开以刷新列表
            </span>
            <span ng-switch-when="action">
              <ons-icon size="30px" spin="true" icon="ion-load-d"></ons-icon>
              树洞加载中
            </span>
          </span>
        </ons-pull-hook>

        <ons-toolbar fixed-style>
          <div class="left">
            <ons-toolbar-button ng-click="menu.toggleMenu()">
              <ons-icon icon="ion-navicon" size="32px"></ons-icon>
            </ons-toolbar-button>
          </div>
          <div class="center">默认频道</div>
          <div class="right">
            <ons-toolbar-button ng-if="user.get('tsinghuaAuth')" ng-click="navi.pushPageWithHistory('hole/new.html', { animation: 'fade' })">
              <ons-icon icon="ion-android-add" size="32px"></ons-icon>
            </ons-toolbar-button>
          </div>
        </ons-toolbar>

        <div class="hole-list">
          <ons-list>
            <ons-list-item ng-repeat="hole in holes" modifier="tappable"
                           ng-click="navi.pushPageWithHistory('hole/show.html', { animation: 'fade', holeId: hole.getObjectId() })">
              <div class="hole-container">
                <div ng-if="hole.get('images').length > 0" class="image">
                  <img ng-src="{{ hole.get('images')[0].get('file').thumbnailURL(100, 100, 100, false) }}">
                </div>
                <div class="content">
                  {{ hole.get('content') }}
                </div>
                <div class="footer">
                  <span class="author">{{ hole.get('author').get('nickname') }}</span>
                  <span class="publish-time">{{ hole.getCreatedAt()|formatTime }}</span>
                </div>
              </div>

            </ons-list-item>
          </ons-list>
        </div>
      </ons-page>
    </div>

  </ons-sliding-menu>
</ons-page>
